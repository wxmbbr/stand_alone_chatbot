<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BBR Network - Engineering Excellence</title>
    <style>
        /* Main website styles */
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background-color: #fff;
        }

        /* Header */
        .header {
            background-color: #003876;
            padding: 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 100;
            box-sizing: border-box;
            height: 64px;
            display: flex;
            align-items: center;
        }

        .logo-container {
            padding: 10px 20px;
            display: flex;
            align-items: center;
        }

        .logo-img {
            height: 44px;
            margin-right: 10px;
        }

        .logo-text {
            color: white;
            font-size: 20px;
            font-weight: bold;
            text-decoration: none;
        }

        .nav-menu {
            display: flex;
            gap: 30px;
            margin-left: 40px;
        }

        .nav-menu a {
            color: white;
            text-decoration: none;
            font-size: 14px;
            text-transform: uppercase;
            font-weight: 500;
            padding: 22px 0;
        }

        .nav-menu a:hover {
            border-bottom: 3px solid white;
        }

        /* Main content */
        .main-content {
            margin-top: 64px;
        }

        /* Hero section - Using the local background image */
        .hero {
            height: 600px;
            background-image: url('images/web_background.png');
            background-size: cover;
            background-position: center;
            position: relative;
        }
        
        /* Dynamic background for production */
        .hero.production-bg {
            background-image: var(--hero-bg-image);
        }
        
        /* Fallback for when local image fails */
        .hero.no-local-bg {
            background: linear-gradient(135deg, #003876 0%, #004c9e 50%, #0066cc 100%);
        }

        .hero-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
        }

        .hero-content {
            color: white;
            max-width: 800px;
            margin-left: 60px;
            padding: 20px;
        }

        .hero-content h1 {
            font-size: 42px;
            margin-bottom: 20px;
            font-weight: 300;
        }

        .hero-content p {
            font-size: 20px;
            line-height: 1.6;
            font-weight: 300;
        }

        /* Applications section */
        .applications {
            padding: 60px;
            background-color: white;
            position: relative;
            color: #333333;
            min-height: 400px;
            border-top: 1px solid #e6e6e6;
        }

        .applications-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            padding: 60px;
        }

        .applications h2 {
            color: #003876;
            font-size: 32px;
            margin-bottom: 30px;
            font-weight: 300;
            position: relative;
            z-index: 2;
        }

        .applications p {
            font-size: 18px;
            line-height: 1.6;
            color: #333333;
            max-width: 800px;
            position: relative;
            z-index: 2;
        }

        /* Chat widget container - FIXED FOR SCROLLING */
        #chat-widget {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 400px;
            height: 600px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.25);
            display: none;
            overflow: hidden;
            z-index: 1000;
            border: 3px solid #003876;
            /* Add resize capability */
            resize: both;
            min-width: 350px;
            min-height: 400px;
            max-width: 600px;
            max-height: 800px;
        }

        /* Chat widget header */
        .chat-header {
            background-color: #003876;
            color: white;
            padding: 12px 16px;
            font-weight: 500;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e6e6e6;
        }

        .chat-header-title {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chat-close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .chat-close-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        /* Chat iframe - COMPLETELY REDESIGNED FOR SCROLLING */
        #chat-frame {
            width: 100%;
            height: calc(100% - 50px); /* Account for header */
            border: none;
            /* FORCE SCROLLING - Remove all scroll restrictions */
            overflow: visible !important;
            background-color: white;
            /* Remove any potential blocking */
            pointer-events: auto;
        }

        /* Chat toggle button */
        #chat-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 24px;
            background-color: #003876;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-family: Arial, sans-serif;
            font-size: 14px;
            font-weight: 500;
            z-index: 1001;
            box-shadow: 0 3px 12px rgba(0,56,118,0.3);
            transition: all 0.3s ease;
        }

        #chat-toggle:hover {
            background-color: #004c9e;
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,56,118,0.4);
        }

        /* Notification badge */
        .notification-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: #ff4444;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* Loading indicator */
        .chat-loading {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #003876;
            font-size: 14px;
        }

        .loading-spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #003876;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive design */
        @media (max-width: 480px) {
            .header {
                padding: 0 10px;
            }
            
            .nav-menu {
                display: none;
            }

            .hero-content {
                margin-left: 20px;
            }

            .applications-overlay {
                padding: 30px;
            }

            #chat-widget {
                width: calc(100% - 20px);
                height: calc(100% - 100px);
                bottom: 80px;
                right: 10px;
                border-radius: 8px 8px 0 0;
                min-width: auto;
                resize: none;
            }

            #chat-toggle {
                bottom: 20px;
                right: 20px;
                padding: 10px 20px;
                font-size: 13px;
            }
        }

        /* Accessibility improvements */
        @media (prefers-reduced-motion: reduce) {
            #chat-toggle {
                transition: none;
            }
            
            #chat-toggle:hover {
                transform: none;
            }
            
            .loading-spinner {
                animation: none;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo-container">
            <img src="images/BBR_Logo.png" alt="BBR Logo" class="logo-img">
            <a href="#" class="logo-text">BBR Network</a>
        </div>
        <nav class="nav-menu">
            <a href="#">ABOUT US</a>
            <a href="#">BBR FRANCHISE</a>
            <a href="#">APPLICATIONS</a>
            <a href="#">TECHNOLOGIES</a>
            <a href="#">PROJECT FINDER</a>
            <a href="#">DOWNLOADS</a>
            <a href="#">LOCATIONS</a>
        </nav>
    </header>

    <div class="main-content">
        <!-- Hero Section -->
        <section class="hero">
            <div class="hero-overlay">
                <div class="hero-content">
                    <h1>Shaping the built world</h1>
                    <p>BBR is recognized as the leading group of specialized engineering contractors in the field of post-tensioning, stay cable, geotechnical and related construction engineering technologies.</p>
                </div>
            </div>
        </section>

        <!-- Applications Section -->
        <section class="applications">
            <div class="applications-overlay">
                <h2>Applications</h2>
                <p>World-class BBR technologies have been applied to a vast array of different structures - such as bridges, buildings, LNG/LPG tanks, dams, arenas and many more.</p>
            </div>
        </section>
    </div>

    <!-- Chat widget button -->
    <button id="chat-toggle">
        Ask BBR Expert
        <span class="notification-badge" id="notification-badge" style="display: none;">!</span>
    </button>

    <!-- Chat widget container -->
    <div id="chat-widget">
        <div class="chat-header">
            <div class="chat-header-title">
                <img src="images/BBR_Logo.png" alt="BBR" style="height: 20px;">
                <span>BBR Expert Assistant</span>
            </div>
            <button class="chat-close-btn" id="chat-close-btn">Ã—</button>
        </div>
        <div class="chat-loading" id="chat-loading">
            <div class="loading-spinner"></div>
            <div>Loading chat...</div>
        </div>
        <!-- FIXED: Enable full scrolling capability -->
        <iframe id="chat-frame" 
                src="" 
                frameborder="0" 
                scrolling="yes"
                allow="microphone; camera"
                style="overflow: auto !important;">
        </iframe>
    </div>

    <script>
        // Detect environment and set appropriate iframe src
        function getStreamlitUrl() {
            // Check if running locally
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                return 'http://localhost:8501';
            } else {
                return 'https://chatbot-frame-for-homepage.onrender.com';
            }
        }

        // Set iframe source based on environment
        document.addEventListener('DOMContentLoaded', function() {
            const chatFrame = document.getElementById('chat-frame');
            chatFrame.src = getStreamlitUrl();
            
            // Check if background image loads, otherwise use fallback
            checkBackgroundImage();
        });

        // Check if background image loads successfully
        function checkBackgroundImage() {
            const heroSection = document.querySelector('.hero');
            const testImg = new Image();
            
            testImg.onload = function() {
                console.log('Local background image loaded successfully');
            };
            
            testImg.onerror = function() {
                console.log('Local background image failed to load, using fallback');
                heroSection.classList.add('no-local-bg');
                
                // Try to get background from Streamlit iframe
                setTimeout(() => {
                    tryGetBackgroundFromIframe();
                }, 2000);
            };
            
            testImg.src = 'images/web_background.png';
        }

        // Try to get background from Streamlit iframe
        function tryGetBackgroundFromIframe() {
            try {
                const chatFrame = document.getElementById('chat-frame');
                const iframeDoc = chatFrame.contentDocument || chatFrame.contentWindow.document;
                
                if (iframeDoc) {
                    const backgroundData = iframeDoc.querySelector('#background-data');
                    if (backgroundData) {
                        const bgImage = backgroundData.getAttribute('data-background');
                        if (bgImage) {
                            const heroSection = document.querySelector('.hero');
                            heroSection.style.setProperty('--hero-bg-image', `url(${bgImage})`);
                            heroSection.classList.remove('no-local-bg');
                            heroSection.classList.add('production-bg');
                            console.log('Applied background from Streamlit iframe');
                        }
                    }
                }
            } catch (e) {
                console.log('Cannot access iframe content due to CORS:', e);
            }
        }

        // Enhanced chat widget functionality with FORCED SCROLLING
        const chatToggle = document.getElementById('chat-toggle');
        const chatWidget = document.getElementById('chat-widget');
        const chatCloseBtn = document.getElementById('chat-close-btn');
        const chatFrame = document.getElementById('chat-frame');
        const chatLoading = document.getElementById('chat-loading');
        const notificationBadge = document.getElementById('notification-badge');
        let isOpen = false;
        let isLoaded = false;

        // Toggle chat widget visibility
        function toggleChat() {
            isOpen = !isOpen;
            chatWidget.style.display = isOpen ? 'block' : 'none';
            
            if (isOpen) {
                chatToggle.textContent = 'Close Chat';
                notificationBadge.style.display = 'none';
                
                // Show loading if iframe hasn't loaded yet
                if (!isLoaded) {
                    chatLoading.style.display = 'block';
                }
                
                // Focus the iframe for keyboard accessibility
                setTimeout(() => {
                    chatFrame.focus();
                    // Force scrolling capability
                    forceScrolling();
                }, 100);
            } else {
                chatToggle.innerHTML = 'Ask BBR Expert <span class="notification-badge" id="notification-badge" style="display: none;">!</span>';
            }
        }

        // FORCE SCROLLING FUNCTION
        function forceScrolling() {
            try {
                // Set iframe attributes to force scrolling
                chatFrame.setAttribute('scrolling', 'yes');
                chatFrame.style.overflow = 'auto';
                chatFrame.style.overflowY = 'auto';
                chatFrame.style.overflowX = 'hidden';
                
                // Try to access iframe content and force scrolling
                setTimeout(() => {
                    try {
                        const iframeDoc = chatFrame.contentDocument || chatFrame.contentWindow.document;
                        if (iframeDoc) {
                            // Force body to allow scrolling
                            iframeDoc.body.style.overflow = 'auto';
                            iframeDoc.body.style.overflowY = 'auto';
                            iframeDoc.body.style.overflowX = 'hidden';
                            iframeDoc.body.style.height = 'auto';
                            
                            // Find and modify Streamlit containers
                            const mainContainers = iframeDoc.querySelectorAll('.main, [data-testid="stApp"], .stApp');
                            mainContainers.forEach(container => {
                                container.style.overflow = 'auto';
                                container.style.overflowY = 'auto';
                                container.style.overflowX = 'hidden';
                                container.style.height = 'auto';
                                container.style.maxHeight = 'none';
                            });
                            
                            // Find and modify chat containers
                            const chatContainers = iframeDoc.querySelectorAll('.stChatFlow, [data-testid="stChatFlow"]');
                            chatContainers.forEach(container => {
                                container.style.overflow = 'auto';
                                container.style.overflowY = 'scroll';
                                container.style.overflowX = 'hidden';
                                container.style.height = 'auto';
                                container.style.maxHeight = '500px';
                            });
                            
                            // Get background image from Streamlit iframe
                            const backgroundData = iframeDoc.querySelector('#background-data');
                            if (backgroundData) {
                                const bgImage = backgroundData.getAttribute('data-background');
                                if (bgImage) {
                                    // Apply background to hero section
                                    const heroSection = document.querySelector('.hero');
                                    if (heroSection) {
                                        heroSection.style.setProperty('--hero-bg-image', `url(${bgImage})`);
                                        heroSection.classList.add('production-bg');
                                        console.log('Applied production background image');
                                    }
                                }
                            }
                            
                            console.log('Forced scrolling on Streamlit content');
                        }
                    } catch (e) {
                        console.log('Cross-origin restrictions prevent direct content access');
                    }
                }, 1000);
                
            } catch (e) {
                console.log('Error forcing scrolling:', e);
            }
        }

        // Event listeners
        chatToggle.addEventListener('click', toggleChat);
        chatCloseBtn.addEventListener('click', toggleChat);

        // Handle iframe loading
        chatFrame.addEventListener('load', () => {
            isLoaded = true;
            chatLoading.style.display = 'none';
            
            // Force scrolling after load
            setTimeout(forceScrolling, 500);
            
            // Periodically try to force scrolling (in case content changes)
            setInterval(forceScrolling, 3000);
        });

        // Handle iframe loading errors
        chatFrame.addEventListener('error', () => {
            chatLoading.style.display = 'none';
            chatFrame.style.display = 'none';
            
            const errorMsg = document.createElement('div');
            errorMsg.style.cssText = 'padding: 20px; text-align: center; color: #666; font-size: 14px;';
            errorMsg.innerHTML = `
                <p>Unable to load chat interface.</p>
                <p>Please make sure the server is running on port 8501.</p>
                <button onclick="location.reload()" style="padding: 8px 16px; background: #003876; color: white; border: none; border-radius: 4px; cursor: pointer;">Retry</button>
            `;
            chatWidget.appendChild(errorMsg);
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // ESC to close chat
            if (e.key === 'Escape' && isOpen) {
                toggleChat();
            }
            // Ctrl/Cmd + K to open chat
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                if (!isOpen) {
                    toggleChat();
                }
            }
        });

        // Show notification badge when chat is closed (simulate new messages)
        function showNotification() {
            if (!isOpen) {
                notificationBadge.style.display = 'block';
            }
        }

        // Force scrolling periodically (aggressive approach)
        setInterval(() => {
            if (isOpen && isLoaded) {
                forceScrolling();
            }
        }, 5000);

        // Simulate notifications (you can remove this in production)
        setTimeout(showNotification, 10000); // Show notification after 10 seconds
    </script>
</body>
</html> 